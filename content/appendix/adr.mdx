---
title: "ADR"
---

---

# Architecture Decision Records (ADR)

Ce document synth√©tise les d√©cisions structurantes du projet.

Format :

* **Contexte**
* **D√©cision**
* **Cons√©quences**

---

## ADR-001 ‚Äî S√©paration stricte Write / Read (CQRS)

### Contexte

Les interactions sociales (like, comment, ticket verification) n√©cessitent :

* r√©silience
* scalabilit√©
* mise √† jour temps r√©el
* isolation m√©tier

Un mod√®le CRUD unifi√© aurait simplifi√© l‚Äôimpl√©mentation initiale.

### D√©cision

Adopter CQRS strict :

* write model isol√©
* read model d√©normalis√©
* projection via Kafka

### Cons√©quences

‚úÖ Meilleure scalabilit√©
‚úÖ Rebuild possible des projections
‚ö†Ô∏è Eventual consistency
‚ö†Ô∏è Complexit√© accrue

---

## ADR-002 ‚Äî Outbox persist√©e c√¥t√© backend

### Contexte

La publication d‚Äô√©v√©nements imm√©diatement apr√®s un write cr√©e un risque :

* crash entre DB et Kafka
* double publication
* incoh√©rence d‚Äô√©tat

### D√©cision

Introduire une table `outbox` transactionnelle :

* write + event persist√©s ensemble
* dispatcher asynchrone
* retry avec backoff

### Cons√©quences

‚úÖ Atomicit√© garantie
‚úÖ Delivery at-least-once
‚ö†Ô∏è Latence l√©g√®rement accrue
‚ö†Ô∏è Besoin de monitoring

---

## ADR-003 ‚Äî Outbox c√¥t√© client mobile

### Contexte

Le r√©seau mobile est instable.

Un POST direct entra√Æne :

* perte d‚Äôactions
* UX incoh√©rente
* double soumission

### D√©cision

Mettre en place une Outbox locale persist√©e :

* enqueue des commandes
* retry exponentiel
* squash intelligent
* idempotence via commandId

### Cons√©quences

‚úÖ UX fluide offline
‚úÖ Aucune perte d‚Äôaction
‚ö†Ô∏è Complexit√© front accrue
‚ö†Ô∏è Synchronisation plus subtile

---

## ADR-004 ‚Äî Isolation OCR via CLI externe

### Contexte

L‚Äôint√©gration directe d‚Äôun moteur OCR natif dans la JVM :

* augmente le risque de crash
* complexifie le packaging
* r√©duit la flexibilit√©

### D√©cision

Isoler l‚ÄôOCR dans un ex√©cutable CLI :

* communication via stdin/stdout
* timeout strict
* parsing JSON
* exit codes explicites

### Cons√©quences

‚úÖ Isolation forte
‚úÖ Testabilit√©
‚ö†Ô∏è Overhead process
‚ö†Ô∏è Gestion fine des flux

---

## ADR-005 ‚Äî WebSocket push avec ACK explicite

### Contexte

Le client mobile a besoin :

* de feedback imm√©diat
* de r√©conciliation fiable
* de coh√©rence post-write

### D√©cision

Mettre en place :

* push WebSocket
* message incluant `version` et `serverTime`
* ACK c√¥t√© client

### Cons√©quences

‚úÖ Coh√©rence ma√Ætris√©e
‚úÖ UX temps r√©el
‚ö†Ô∏è Complexit√© de reconnexion
‚ö†Ô∏è Gestion d‚Äô√©tat plus avanc√©e

---

## üß† Synth√®se

Les d√©cisions prises privil√©gient :

* r√©silience
* isolation
* scalabilit√©
* robustesse production

La simplicit√© initiale a √©t√© volontairement sacrifi√©e au profit de la coh√©rence syst√®me.

---
